<Ui xmlns="http://www.blizzard.com/wow/ui/">

	<Button name="CombuctorFrameTabButtonTemplate" inherits="CharacterFrameTabButtonTemplate" virtual="true">
		<Scripts>
			<OnLoad>
				return
			</OnLoad>
			<OnClick>
				local parent = self:GetParent()
				if(parent.selectedTab ~= self:GetID()) then
					PlaySound("igCharacterInfoTab")
				end
				parent:ShowPanel(self:GetID())
			</OnClick>
		</Scripts>
	</Button>
	
	<CheckButton name="CombuctorFrameSideButtonTemplate" inherits="SpellBookSkillLineTabTemplate" virtual="true"/>

	<Frame name="CombuctorFrameTemplate" enableMouse="true" movable="true" sizable="true" toplevel="true" parent="UIParent" hidden="true" virtual="true">
		<Size x="384" y="512"/>

		<Attributes>
			<Attribute name="UIPanelLayout-defined" type="boolean" value="true"/>
			<Attribute name="UIPanelLayout-enabled" type="boolean" value="true"/>
			<Attribute name="UIPanelLayout-whileDead" type="boolean" value="true"/>
			<Attribute name="UIPanelLayout-area" type="string" value="left"/>
			<Attribute name="UIPanelLayout-pushable" type="number" value="1"/>
		</Attributes>

		<HitRectInsets>
			<AbsInset left="0" right="35" top="0" bottom="75"/>
		</HitRectInsets>

		<ClampRectInsets>
			<AbsInset left="0" right="35" top="0" bottom="75"/>
		</ClampRectInsets>

		<Layers>
			<Layer level="BACKGROUND">
				<Texture name="$parentIcon">
					<Size x="62" y="62"/>
				</Texture>
			</Layer>

			<Layer level="ARTWORK">
				<FontString name="$parentTitle" inherits="GameFontHighlight" text="TEXT">
					<Size x="300" y="14"/>
					<Anchors>
						<Anchor point="TOP">
							<Offset x="0" y="-16"/>
						</Anchor>
					</Anchors>
				</FontString>

				<Texture file="Interface\MerchantFrame\UI-Merchant-TopLeft">
					<Size>
						<AbsDimension x="256" y="256"/>
					</Size>
					<Anchors>
						<Anchor point="TOPLEFT"/>
					</Anchors>
				</Texture>
				
				<Texture file="Interface\MerchantFrame\UI-Merchant-TopRight">
					<Size>
						<AbsDimension x="128" y="256"/>
					</Size>
					<Anchors>
						<Anchor point="TOPRIGHT"/>
					</Anchors>
				</Texture>

				<Texture file="Interface\MerchantFrame\UI-Merchant-BotLeft">
					<Size>
						<AbsDimension x="256" y="256"/>
					</Size>
					<Anchors>
						<Anchor point="BOTTOMLEFT"/>
					</Anchors>
				</Texture>

				<Texture file="Interface\MerchantFrame\UI-Merchant-BotRight">
					<Size>
						<AbsDimension x="128" y="256"/>
					</Size>
					<Anchors>
						<Anchor point="BOTTOMRIGHT"/>
					</Anchors>
				</Texture>
			</Layer>
		</Layers>

		<Frames>
	        <Button name="$parentCloseButton" inherits="UIPanelCloseButton">
				<Anchors>
					<Anchor point="TOPRIGHT">
						<Offset x="-29" y="-8"/>
					</Anchor>
				</Anchors>
	        </Button>

			<!-- Fact: I should rename this.  The clickable portion of the portrat: used toggle the character list and bag frames -->
			<Button name="$parentIconButton">
				<Size x="64" y="64"/>

				<Anchors>
					<Anchor point="TOPLEFT">
						<Offset x="4" y="-4"/>
					</Anchor>
				</Anchors>

				<Scripts>
					<OnLoad>
						self:RegisterForClicks("anyUp")
						self.icon = getglobal(self:GetParent():GetName().."Icon")
						self.icon:ClearAllPoints()
						self.icon:SetPoint("CENTER", self)
					</OnLoad>
					<OnEvent>
						if(self:IsShown() and arg1 == "player") then
							SetPortraitTexture(self.icon, arg1)
						end
					</OnEvent>
					<OnShow>
						SetPortraitTexture(self.icon, "player")
						self:RegisterEvent("UNIT_PORTRAIT_UPDATE")
					</OnShow>
					<OnHide>
						self:UnregisterEvent("UNIT_PORTRAIT_UPDATE")
					</OnHide>
					<OnMouseDown>
						self.icon:SetWidth(56)
						self.icon:SetHeight(56)
						self.icon:SetTexCoord(0.075, 0.925, 0.075, 0.925)
					</OnMouseDown>
					<OnMouseUp>
						self.icon:SetWidth(62)
						self.icon:SetHeight(62)
						self.icon:SetTexCoord(0, 1, 0, 1)
					</OnMouseUp>
					<OnClick>
						if(arg1 == "LeftButton") then
							if BagnonDB then
								BagnonDB:SetDropdownFrame(self:GetParent())
								BagnonDB:ToggleDropdown(self, 20, 32)
							end
						end
					</OnClick>
				</Scripts>

				<HighlightTexture alphaMode="ADD" file="Interface\Minimap\UI-Minimap-ZoomButton-Highlight">
					<Size x="78" y="78"/>
					<Anchors>
						<Anchor point="CENTER"/>
					</Anchors>
				</HighlightTexture>
			</Button>

			<EditBox name="$parentSearch" autoFocus="false" inherits="InputBoxTemplate">
				<Size x="218" y="20"/>

				<Anchors>
					<Anchor point="TOPLEFT">
						<Offset x="84" y="-44"/>
					</Anchor>
				</Anchors>

				<Scripts>
					<OnShow>
						if (self:GetText() == "") then
							self:SetText(SEARCH)
						end
					</OnShow>
					<OnEnterPressed>
						self:ClearFocus()
					</OnEnterPressed>
					<OnTextChanged>
						if self:HasFocus() then
							local text = self:GetText()
							if text == '' then 
								text = nil 
							end
							self:GetParent().itemFrame:SetFilter('name', text and text:lower() or nil)
						end
					</OnTextChanged>
					<OnEditFocusLost>
						self:HighlightText(0, 0)
						if (self:GetText() == "") then
							self:SetText(SEARCH)
						end
					</OnEditFocusLost>
					<OnEditFocusGained>
						self:HighlightText()
						if (self:GetText() == SEARCH) then
							self:SetText("")
						end
					</OnEditFocusGained>
				</Scripts>
			</EditBox>

			<Button name="$parentReset">
				<Size x="39" y="39"/>

				<Anchors>
					<Anchor point="LEFT" relativeTo="$parentSearch" relativePoint="RIGHT">
						<Offset x="-2" y="-2"/>
					</Anchor>
				</Anchors>

				<Scripts>
					<OnClick>
						-- Combuctor:Reset()
					</OnClick>
				</Scripts>

				<NormalTexture file="Interface\Buttons\CancelButton-Up"/>
				<PushedTexture file="Interface\Buttons\CancelButton-Down"/>
				<HighlightTexture file="Interface\Buttons\CancelButton-Highlight" alphaMode="ADD"/>
			</Button>
		</Frames>
	</Frame>
</Ui>